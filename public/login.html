<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Login</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>

  <h2>Login</h2>
  <input type="text" id="identifier" placeholder="Email or Matricule"><br><br>
  <input type="password" id="password" placeholder="Password"><br><br>
  <button id="loginBtn">Login</button>
  <p id="message"></p>

<script>
    $('#loginBtn').click(function() {
    const data = {
        identifier: $('#identifier').val(),
        password: $('#password').val()
    };

    // Compute API base relative to possible `/public/` mount
    const _p = location.pathname;
    const _idx = _p.indexOf('/public/');
    const API_BASE_LOCAL = _idx !== -1 ? _p.slice(0, _idx) + '/api' : '/api';

    $.ajax({
        url: API_BASE_LOCAL + '/auth/login.php',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(data),
        success: function(res) {
        if (res.success) {
            $('#message').text(res.message);
            if (res.role === 'admin') window.location.href = 'admin/dashboard.html';
            else if (res.role === 'teacher') window.location.href = 'teacher/dashboard.html';
            else if (res.role === 'student') window.location.href = 'student/dashboard.html';
        } else {
            $('#message').text(res.message);
        }
        },
        error: function() {
        $('#message').text('Error connecting to server.');
        }
    });
    });
</script>

</body>
</html>
